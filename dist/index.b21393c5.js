!function(){var e={};Object.defineProperty(e,"__esModule",{value:!0});var t=M;e.beginCircle=t;var r=K;e.radians=r;var o=function(e,t={}){const r=e.descriptor,o=Object.assign(L,t);this.save();const{w:n,h:i,shadowColor:s}=o;this.canvas.width=n,this.canvas.height=i,this.fillStyle=o.backgroundColor;this.fillRect(0,0,n,i),this.translate(1*n/2,1*i/2),this.scale(1*n/28,1*i/28);const l=10;s&&(this.fillStyle=s,M.call(this,0,0,11.5),this.fill());for(let e=0;e<r.length;++e){const t=r[e],n=Math.max(.1,.9-.22*e);for(let e=0;e<4;++e){if(!t[e])continue;const{subShape:r,color:i}=t[e],s=$[e],c=5*s.x,h=5*s.y,d=K(90*e);this.translate(c,h),this.rotate(d),this.fillStyle=a.ColorHexCodes[i],this.strokeStyle=o.outlineColor||"rgba(0, 0, 0, 0)",this.lineWidth=1;const u=0;switch(r){case g.SubShape.rect:{this.beginPath();const e=l*n;this.rect(u+-5,5-u-e,e,e);break}case g.SubShape.star:{this.beginPath();const e=l*n,t=u-5,r=5-u-e,o=.4*e;this.moveTo(t,r+o),this.lineTo(t+e,r),this.lineTo(t+e-o,r+e),this.lineTo(t,r+e),this.closePath();break}case g.SubShape.windmill:{this.beginPath();const e=l*n,t=u-5,r=5-u-e,o=.4*e;this.moveTo(t,r+o),this.lineTo(t+e,r),this.lineTo(t+e,r+e),this.lineTo(t,r+e),this.closePath();break}case g.SubShape.circle:this.beginPath(),this.moveTo(u+-5,5-u),this.arc(u+-5,5-u,l*n,.5*-Math.PI,0),this.closePath();break;default:throw new Error("Unkown sub shape: "+r)}this.fill(),this.stroke(),this.rotate(-d),this.translate(-c,-h)}}this.restore()};e.renderShape=o;var n=void 0;e.arrayQuadrantIndexToOffset=n;var a={};Object.defineProperty(a,"__esModule",{value:!0});var i=(c=void 0,d=a.Color=c,u=a.ColorShortCode=d,f=a.ColorHexCodes=u,a.ShortCodeToColor=f);let s;a.possibleColorsString=i;var l,c=s;a.Color=c,(l=s||(c=s={},a.Color=c)).red="red",l.green="green",l.blue="blue",l.yellow="yellow",l.purple="purple",l.cyan="cyan",l.white="white",l.uncolored="uncolored";const h={[s.red]:"r",[s.green]:"g",[s.blue]:"b",[s.yellow]:"y",[s.purple]:"p",[s.cyan]:"c",[s.white]:"w",[s.uncolored]:"u"};var d=h;a.ColorShortCode=d;var u={[s.red]:"#ff666a",[s.green]:"#78ff66",[s.blue]:"#66a7ff",[s.yellow]:"#fcf52a",[s.purple]:"#dd66ff",[s.cyan]:"#87fff5",[s.white]:"#ffffff",[s.uncolored]:"#aaaaaa"};a.ColorHexCodes=u;const p={};var f=p;a.ShortCodeToColor=f;for(const e in h)p[h[e]]=e;i=Object.keys(p).join(""),a.possibleColorsString=i;var g={};Object.defineProperty(g,"__esModule",{value:!0});var y=(v=void 0,w=g.SubShape=v,C=g.maxLayer=w,E=g.SubShapeShortCode=C,O=g.ShortCodeToSubShape=E,I=g.possibleShapesString=O,_=g.layerRegex=I,g.ShortKeyConversionError=_);let S;g.Shape=y;var b,v=S;g.SubShape=v,(b=S||(v=S={},g.SubShape=v)).rect="rect",b.circle="circle",b.star="star",b.windmill="windmill";var w=4;g.maxLayer=w;const m={[S.rect]:"R",[S.circle]:"C",[S.star]:"S",[S.windmill]:"W"};var C=m;g.SubShapeShortCode=C;const x={};var E=x;g.ShortCodeToSubShape=E;for(const e in m)x[m[e]]=e;const P=Object.keys(x).join("");var O=P;g.possibleShapesString=O;const T=new RegExp("(["+P+"]["+a.possibleColorsString+"]|-{2}){4}");var I=T;g.layerRegex=I;class j extends Error{}var _=j;g.ShortKeyConversionError=_;class k{get descriptor(){return this._descriptor}constructor(e){this._descriptor=e}toString(){return`Shape(${this.toShortKey()})`}[Symbol.iterator]=function*(){yield*this.descriptor[Symbol.iterator]()}.bind(this);clone(){const e=this.descriptor;return new k(e.map((e=>{const t=e.map((e=>null===e?null:{...e}));if(4!==t.length)throw new Error("Unexpected error in cloneShape: layer does not have 4 quads");return t})))}toShortKey(){return this.descriptor.map((e=>e.map((e=>null===e?"--":m[e.subShape]+a.ColorShortCode[e.color])).join(""))).join(":")}static fromShortKey(e){const t=e.split(":");if(!t[0])throw new j("Expected 1-4 layers, recieved 0");if(t.length>4)throw new j(`Expected 1-4 layers, recieved ${t.length}`);const r=[];for(let o=0;o<t.length;++o){const n=t[o];if(8!==n.length)throw new j("Invalid layer: '"+n+"' -> must be 8 characters");if(n==="--".repeat(4))throw new j("Empty layers are not allowed");if(!T.test(n))throw new j("Invalid syntax in layer "+(o+1));const i=[null,null,null,null];for(let t=0;t<4;++t){const r=n[2*t+0],o=x[r],s=a.ShortCodeToColor[n[2*t+1]];if(o){if(!s)throw new j("Invalid shape color key: "+e);i[t]={subShape:o,color:s}}else if("-"!==r)throw new j("Invalid shape key: "+r)}r.push(i)}return new k(r)}}y=k,g.Shape=y;const $=[{x:1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}];function M(e,t,r){if(r<.05)return this.beginPath(),void this.rect(e,t,1,1);this.beginPath(),this.arc(e,t,r,0,2*Math.PI)}function K(e){return e*Math.PI/180}n=$,e.arrayQuadrantIndexToOffset=n;const L={backgroundColor:"#fff",w:512,h:512,shadowColor:"rgba(40, 50, 65, 0.1)",outlineColor:"#555"};var Q={};Object.defineProperty(Q,"__esModule",{value:!0});var R=(oe=void 0,ne=Q.Paint=oe,Q.QuadPaint=ne);Q.DoublePaint=R;var A={};Object.defineProperty(A,"__esModule",{value:!0});var D=function(e){return function(t){te(t,e.ingredients);try{let r=e.operate(t);return{name:e.name,ingredients:t,isError:!1,result:r}}catch(r){if(r instanceof ee)return{name:e.name,ingredients:t,isError:!0,error:r.message};throw r}}};A.createOperation=D;var G=(Z=void 0,A.OperationIngredientTypeMismatchError=Z);A.OperationInvalidIngredientError=G;var q={};Object.defineProperty(q,"__esModule",{value:!0});var B=F;q.isSubShape=B;var H=J;q.isColor=H;var U=V;q.isLayer=U;var W=X;q.isShape=W;var N=function(e){return e instanceof Array&&e.length>0&&e.length<=4&&e.every(V)};q.isShapeDescriptor=N;var z=function(e){return"boolean"==typeof e?"boolean":J(e)?"color":X(e)?"shape":null};function F(e){return"string"==typeof e&&!!g.SubShape[e]}function J(e){return"string"==typeof e&&e in a.Color}function V(e){return e instanceof Array&&4===e.length&&(!e.every((e=>null===e))&&e.every((e=>null===e||e instanceof Object&&("subShape"in e&&"color"in e&&(F(e.subShape)&&J(e.color))))))}function X(e){return e instanceof g.Shape}q.getGameObjectType=z;class Y extends Error{}var Z=Y;A.OperationIngredientTypeMismatchError=Z;class ee extends Error{}function te(e,t){if(e.length!==t.length)throw new Y(`Ingredient array length (${e.length}) not equal to expected length (${t.length})`);e.forEach(((e,r)=>{const o=t[r];if(o instanceof Array){if(!(e instanceof Array))throw new Y(`Expected array, got '${e}' in ingredient ${r}`);if(e.length!==o.length)throw new Y(`Ingredient array length (${e.length}) in ingredient ${r} not equal to expected length (${o.length})`);try{te(e,o)}catch(e){throw e instanceof Y&&(e.message=e.message.replace(/ingredient/g,"index")+` in ingredient ${r}`),e}}else if((0,q.getGameObjectType)(e)!==o)throw new Y(`Expected ${o}, got '${e}' in ingredient ${r}`)}))}function re(e,t){const r=e.clone().descriptor;for(let e=0;e<r.length;++e){const o=r[e];for(let e=0;e<4;++e){const r=o[e];r&&(r.color=t)}}return new g.Shape(r)}G=ee,A.OperationInvalidIngredientError=G;var oe=(0,A.createOperation)({name:"Paint",ingredients:["shape","color"],result:"shape",operate:e=>re(...e)});Q.Paint=oe;var ne=(0,A.createOperation)({name:"QuadPaint",ingredients:["shape",["color","color","color","color"],["boolean","boolean","boolean","boolean"]],result:"shape",operate:([e,t,r])=>function(e,t){const r=e.clone().descriptor;for(let e=0;e<r.length;++e){const o=r[e];for(let e=0;e<4;++e){const r=o[e];r&&(r.color=t[e]||r.color)}}return new g.Shape(r)}(e,t.map(((e,t)=>r[t]?e:null)))});Q.QuadPaint=ne;R=(0,A.createOperation)({name:"DoublePaint",ingredients:[["shape","shape"],"color"],result:["shape","shape"],operate:([e,t])=>e.map((e=>re(e,t)))}),Q.DoublePaint=R;const ae=document.getElementById("code"),ie=document.getElementById("error"),se=document.getElementById("result").getContext("2d");if(null==se)throw new Error("No context found for canvas");const le=()=>{try{e.renderShape.call(se,g.Shape.fromShortKey(ae.value)),ie.textContent="Shape generated",ie.classList.remove("hasError")}catch(e){if(e instanceof g.ShortKeyConversionError)ie.textContent="Error: "+e.message,ie.classList.add("hasError");else if(e instanceof Error)throw e}};le(),ae.onchange=le;const ce={Paint:Q.Paint,Shape:g.Shape,getGameObjectType:q.getGameObjectType};Object.assign(window,ce)}();
//# sourceMappingURL=index.b21393c5.js.map
