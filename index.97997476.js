!function(){var e={};Object.defineProperty(e,"__esModule",{value:!0});var t=function(e,t={}){const o=e.descriptor,n=Object.assign(k,t);this.save();const{w:a,h:i,shadowColor:s}=n;this.canvas.width=a,this.canvas.height=i,this.fillStyle=n.backgroundColor;this.fillRect(0,0,a,i),this.translate(1*a/2,1*i/2),this.scale(1*a/28,1*i/28);const l=10;s&&(this.fillStyle=s,_.call(this,0,0,11.5),this.fill());for(let e=0;e<o.length;++e){const t=o[e],a=Math.max(.1,.9-.22*e);for(let e=0;e<4;++e){if(!t[e])continue;const{subShape:o,color:i}=t[e],s=j[e],c=5*s.x,h=5*s.y,d=90*e*Math.PI/180;this.translate(c,h),this.rotate(d),this.fillStyle=r.ColorHexCodes[i],this.strokeStyle=n.outlineColor||"rgba(0, 0, 0, 0)",this.lineWidth=1;const p=0;switch(o){case u.SubShape.rect:{this.beginPath();const e=l*a;this.rect(p+-5,5-p-e,e,e);break}case u.SubShape.star:{this.beginPath();const e=l*a,t=p-5,r=5-p-e,o=.4*e;this.moveTo(t,r+o),this.lineTo(t+e,r),this.lineTo(t+e-o,r+e),this.lineTo(t,r+e),this.closePath();break}case u.SubShape.windmill:{this.beginPath();const e=l*a,t=p-5,r=5-p-e,o=.4*e;this.moveTo(t,r+o),this.lineTo(t+e,r),this.lineTo(t+e,r+e),this.lineTo(t,r+e),this.closePath();break}case u.SubShape.circle:this.beginPath(),this.moveTo(p+-5,5-p),this.arc(p+-5,5-p,l*a,.5*-Math.PI,0),this.closePath();break;default:throw new Error("Unkown sub shape: "+o)}this.fill(),this.stroke(),this.rotate(-d),this.translate(-c,-h)}}this.restore()};e.default=t;var r={};Object.defineProperty(r,"__esModule",{value:!0});var o=(i=void 0,l=r.Color=i,c=r.ColorShortCode=l,d=r.ColorHexCodes=c,r.ShortCodeToColor=d);let n;r.possibleColorsString=o;var a,i=n;r.Color=i,(a=n||(i=n={},r.Color=i)).red="red",a.green="green",a.blue="blue",a.yellow="yellow",a.purple="purple",a.cyan="cyan",a.white="white",a.uncolored="uncolored";const s={[n.red]:"r",[n.green]:"g",[n.blue]:"b",[n.yellow]:"y",[n.purple]:"p",[n.cyan]:"c",[n.white]:"w",[n.uncolored]:"u"};var l=s;r.ColorShortCode=l;var c={[n.red]:"#ff666a",[n.green]:"#78ff66",[n.blue]:"#66a7ff",[n.yellow]:"#fcf52a",[n.purple]:"#dd66ff",[n.cyan]:"#87fff5",[n.white]:"#ffffff",[n.uncolored]:"#aaaaaa"};r.ColorHexCodes=c;const h={};var d=h;r.ShortCodeToColor=d;for(const e in s)h[s[e]]=e;o=Object.keys(h).join(""),r.possibleColorsString=o;var u={};Object.defineProperty(u,"__esModule",{value:!0});var p=(y=void 0,S=u.SubShape=y,v=u.maxLayer=S,m=u.SubShapeShortCode=v,E=u.ShortCodeToSubShape=m,P=u.possibleShapesString=E,I=u.layerRegex=P,u.ShortKeyConversionError=I);let f;u.Shape=p;var g,y=f;u.SubShape=y,(g=f||(y=f={},u.SubShape=y)).rect="rect",g.circle="circle",g.star="star",g.windmill="windmill";var S=4;u.maxLayer=S;const b={[f.rect]:"R",[f.circle]:"C",[f.star]:"S",[f.windmill]:"W"};var v=b;u.SubShapeShortCode=v;const w={};var m=w;u.ShortCodeToSubShape=m;for(const e in b)w[b[e]]=e;const C=Object.keys(w).join("");var E=C;u.possibleShapesString=E;const x=new RegExp("(["+C+"]["+r.possibleColorsString+"]|-{2}){4}");var P=x;u.layerRegex=P;class O extends Error{}var I=O;u.ShortKeyConversionError=I;class T{get descriptor(){return this._descriptor}constructor(e){this._descriptor=e}toString(){return`Shape(${this.toShortKey()})`}[Symbol.iterator]=function*(){yield*this.descriptor[Symbol.iterator]()}.bind(this);clone(){const e=this.descriptor;return new T(e.map((e=>{const t=e.map((e=>null===e?null:{...e}));if(4!==t.length)throw new Error("Unexpected error in cloneShape: layer does not have 4 quads");return t})))}toShortKey(){return this.descriptor.map((e=>e.map((e=>null===e?"--":b[e.subShape]+r.ColorShortCode[e.color])).join(""))).join(":")}static fromShortKey(e){const t=e.split(":");if(!t[0])throw new O("Expected 1-4 layers, recieved 0");if(t.length>4)throw new O(`Expected 1-4 layers, recieved ${t.length}`);const o=[];for(let n=0;n<t.length;++n){const a=t[n];if(8!==a.length)throw new O("Invalid layer: '"+a+"' -> must be 8 characters");if(a==="--".repeat(4))throw new O("Empty layers are not allowed");if(!x.test(a))throw new O("Invalid syntax in layer "+(n+1));const i=[null,null,null,null];for(let t=0;t<4;++t){const o=a[2*t+0],n=w[o],s=r.ShortCodeToColor[a[2*t+1]];if(n){if(!s)throw new O("Invalid shape color key: "+e);i[t]={subShape:n,color:s}}else if("-"!==o)throw new O("Invalid shape key: "+o)}o.push(i)}return new T(o)}}p=T,u.Shape=p;const j=[{x:1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}];function _(e,t,r){if(r<.05)return this.beginPath(),void this.rect(e,t,1,1);this.beginPath(),this.arc(e,t,r,0,2*Math.PI)}const k={backgroundColor:"#fff",w:512,h:512,shadowColor:"rgba(40, 50, 65, 0.1)",outlineColor:"#555"};var M,$=(M=e)&&M.__esModule?M:{default:M},K={};Object.defineProperty(K,"__esModule",{value:!0});var A=(re=void 0,oe=K.Paint=re,K.QuadPaint=oe);K.DoublePaint=A;var L={};Object.defineProperty(L,"__esModule",{value:!0});var R=function(e){return function(t){ee(t,e.ingredients);try{let r=e.operate(t);return{name:e.name,ingredients:t,isError:!1,result:r}}catch(r){if(r instanceof Z)return{name:e.name,ingredients:t,isError:!0,error:r.message};throw r}}};L.createOperation=R;var D=(Y=void 0,L.OperationIngredientTypeMismatchError=Y);L.OperationInvalidIngredientError=D;var G={};Object.defineProperty(G,"__esModule",{value:!0});var q=z;G.isSubShape=q;var B=F;G.isColor=B;var H=J;G.isLayer=H;var Q=V;G.isShape=Q;var U=function(e){if("string"!=typeof e)return!1;try{return u.Shape.fromShortKey(e),!0}catch(e){if(e instanceof u.ShortKeyConversionError)return!1;throw e}};G.isShapeKey=U;var W=function(e){return e instanceof Array&&e.length>0&&e.length<=4&&e.every(J)};G.isShapeDescriptor=W;var N=function(e){return"boolean"==typeof e?"boolean":F(e)?"color":V(e)?"shape":null};function z(e){return"string"==typeof e&&!!u.SubShape[e]}function F(e){return"string"==typeof e&&e in r.Color}function J(e){return e instanceof Array&&4===e.length&&(!e.every((e=>null===e))&&e.every((e=>null===e||e instanceof Object&&("subShape"in e&&"color"in e&&(z(e.subShape)&&F(e.color))))))}function V(e){return e instanceof u.Shape}G.getGameObjectType=N;class X extends Error{}var Y=X;L.OperationIngredientTypeMismatchError=Y;class Z extends Error{}function ee(e,t){if(e.length!==t.length)throw new X(`Ingredient array length (${e.length}) not equal to expected length (${t.length})`);e.forEach(((e,r)=>{const o=t[r];if(o instanceof Array){if(!(e instanceof Array))throw new X(`Expected array, got '${e}' in ingredient ${r}`);if(e.length!==o.length)throw new X(`Ingredient array length (${e.length}) in ingredient ${r} not equal to expected length (${o.length})`);try{ee(e,o)}catch(e){throw e instanceof X&&(e.message=e.message.replace(/ingredient/g,"index")+` in ingredient ${r}`),e}}else if((0,G.getGameObjectType)(e)!==o)throw new X(`Expected ${o}, got '${e}' in ingredient ${r}`)}))}function te(e,t){if(t===r.Color.uncolored)throw new L.OperationInvalidIngredientError("A shape cannot be painted uncolored");const o=e.clone().descriptor;for(let e=0;e<o.length;++e){const r=o[e];for(let e=0;e<4;++e){const o=r[e];o&&(o.color=t)}}return new u.Shape(o)}D=Z,L.OperationInvalidIngredientError=D;var re=(0,L.createOperation)({name:"Paint",ingredients:["shape","color"],result:"shape",operate:e=>te(...e)});K.Paint=re;var oe=(0,L.createOperation)({name:"QuadPaint",ingredients:["shape",["color","color","color","color"],["boolean","boolean","boolean","boolean"]],result:"shape",operate:([e,t,o])=>{if(!o.some((e=>!!e)))throw new L.OperationInvalidIngredientError("At least one wire must be activated");return function(e,t){if(t.some((e=>e===r.Color.uncolored)))throw new L.OperationInvalidIngredientError("A shape cannot be painted uncolored");const o=e.clone().descriptor;for(let e=0;e<o.length;++e){const r=o[e];for(let e=0;e<4;++e){const o=r[e],n=t[e];o&&n&&(o.color=n)}}return new u.Shape(o)}(e,t.map(((e,t)=>o[t]?e:null)))}});K.QuadPaint=oe;A=(0,L.createOperation)({name:"DoublePaint",ingredients:[["shape","shape"],"color"],result:["shape","shape"],operate:([e,t])=>e.map((e=>te(e,t)))}),K.DoublePaint=A;const ne=document.getElementById("code"),ae=document.getElementById("error"),ie=document.getElementById("result").getContext("2d");if(null==ie)throw new Error("No context found for canvas");const se=()=>{try{$.default.call(ie,u.Shape.fromShortKey(ne.value)),ae.textContent="Shape generated",ae.classList.remove("hasError")}catch(e){if(e instanceof u.ShortKeyConversionError)ae.textContent="Error: "+e.message,ae.classList.add("hasError");else if(e instanceof Error)throw e}};se(),ne.onchange=se;const le={Paint:K.Paint,Shape:u.Shape,getGameObjectType:G.getGameObjectType};Object.assign(window,le)}();
//# sourceMappingURL=index.97997476.js.map
